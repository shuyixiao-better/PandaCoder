# Git 统计邮件发送功能 - 方案总结

## 📌 方案概览

为您的 PandaCoder 插件的 **Git 统计工具窗口** 增加邮件发送功能，实现每日代码统计自动发送到您的邮箱。

---

## ✨ 核心功能

### 1️⃣ 手动发送
- 在工具窗口点击"立即发送"按钮
- 可选择发送指定日期的统计报告
- 支持邮件预览功能

### 2️⃣ 定时发送
- 每天定时自动发送（可配置发送时间，如 18:00）
- 自动统计昨日或当日的代码编写情况
- IDE 启动时自动恢复定时任务

### 3️⃣ 统计内容
**基础统计**:
- 📝 提交次数
- ➕ 新增代码行数
- ➖ 删除代码行数
- 📊 净代码变化量

**趋势分析**（可选）:
- 📈 近 7 天趋势图表
- 📊 近 30 天趋势对比
- 🏆 个人排名信息

### 4️⃣ 精美邮件
- **HTML 格式**: 美观的渐变色设计，图表展示
- **纯文本**: 备选方案，确保兼容性
- **响应式**: 适配移动端和桌面端

### 5️⃣ 灵活配置
- 支持主流邮箱（Gmail、QQ、163 等）
- 可筛选特定作者或统计所有开发者
- 自定义邮件主题和发送时间
- SMTP 密码加密存储

---

## 🏗️ 技术架构

```
┌─────────────────────────────────────────┐
│     Git 统计工具窗口 UI                  │
│  [配置] [发送] [历史] [预览]            │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│   GitStatEmailService (核心服务)        │
│  • 数据收集                             │
│  • 模板渲染                             │
│  • SMTP 发送                            │
│  • 定时调度                             │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│         外部依赖                         │
│  • GitStatService (已有)                │
│  • JavaMail API                         │
│  • SMTP Server (Gmail/QQ/163)           │
└─────────────────────────────────────────┘
```

---

## 📦 需要添加的依赖

在 `build.gradle` 中添加:

```gradle
dependencies {
    // ... 现有依赖 ...
    
    // JavaMail API
    implementation 'com.sun.mail:javax.mail:1.6.2'
    implementation 'com.sun.activation:jakarta.activation:1.2.2'
}
```

---

## 📁 新增文件结构

```
src/main/java/com/shuyixiao/gitstat/
└── email/                                    # 新建邮件功能包
    ├── model/
    │   ├── GitStatEmailConfig.java          # 邮件配置
    │   ├── GitStatEmailContent.java         # 邮件内容
    │   └── GitStatEmailRecord.java          # 发送记录
    ├── service/
    │   ├── GitStatEmailService.java         # 核心服务 ⭐
    │   └── EmailTemplateService.java        # 模板服务
    ├── ui/
    │   └── EmailConfigPanel.java            # 配置界面
    └── util/
        └── PasswordEncryptor.java           # 密码加密

src/main/resources/email/
└── templates/
    ├── daily-report.html                    # HTML 模板
    └── daily-report.txt                     # 纯文本模板
```

---

## 🎨 邮件效果预览

### HTML 邮件效果

```
┌─────────────────────────────────────────┐
│                                          │
│         📊 Git 统计日报                  │
│     2025-10-22 | 张三                    │
│                                          │
│  🎯 今日概览                             │
│  ┌──────────────────────────────────┐  │
│  │  提交次数    新增代码    删除代码  │  │
│  │     12       +450       -120      │  │
│  │                                    │  │
│  │      净变化: +330 行               │  │
│  └──────────────────────────────────┘  │
│                                          │
│  📈 近7天趋势                            │
│  [柱状图显示]                            │
│                                          │
│  🏆 统计排名                             │
│  提交排名: 第 2 名 | 代码量排名: 第 1 名 │
│                                          │
└─────────────────────────────────────────┘
```

### 纯文本邮件效果

```
========================================
📊 Git 统计日报
========================================
日期: 2025-10-22
作者: 张三

🎯 今日概览
----------------------------------------
提交次数: 12
新增代码: +450 行
删除代码: -120 行
净变化:   +330 行

📈 近7天趋势
----------------------------------------
[文本图表显示]

🏆 统计排名
----------------------------------------
提交次数排名: 第 2 名
代码量排名:   第 1 名
========================================
```

---

## ⚙️ 邮箱配置速查

### Gmail

| 配置项 | 值 |
|--------|-----|
| SMTP 服务器 | `smtp.gmail.com` |
| 端口 | `587` |
| TLS | ✅ 启用 |
| SSL | ❌ 禁用 |
| 密码 | **应用专用密码**（非 Gmail 密码） |

> 💡 Gmail 需要开启"两步验证"并生成"应用专用密码"

### QQ 邮箱

| 配置项 | 值 |
|--------|-----|
| SMTP 服务器 | `smtp.qq.com` |
| 端口 | `587` 或 `465` |
| TLS | ✅（587端口）|
| SSL | ✅（465端口）|
| 密码 | **授权码**（非 QQ 密码） |

> 💡 需在 QQ 邮箱设置中开启 SMTP 服务并生成授权码

### 163 邮箱

| 配置项 | 值 |
|--------|-----|
| SMTP 服务器 | `smtp.163.com` |
| 端口 | `465` |
| TLS | ❌ 禁用 |
| SSL | ✅ 启用 |
| 密码 | **客户端授权密码** |

> 💡 需在 163 邮箱设置中开启 SMTP 服务并设置授权密码

---

## 🚀 实施步骤

### 阶段一：基础功能（2-3天）
1. ✅ 添加依赖
2. ✅ 创建数据模型
3. ✅ 实现邮件服务
4. ✅ 集成到工具窗口
5. ✅ 测试手动发送

### 阶段二：定时任务（1天）
1. ✅ 实现定时调度
2. ✅ 添加配置界面
3. ✅ 测试自动发送

### 阶段三：优化完善（1-2天）
1. ✅ HTML 邮件模板
2. ✅ 密码加密存储
3. ✅ 发送历史记录
4. ✅ 错误处理

**预计总开发时间**: 4-6 天

---

## 💡 使用场景

### 场景 1: 个人每日总结
- **配置**: 筛选自己的用户名
- **时间**: 每天 18:00 发送
- **内容**: 当日提交统计 + 7天趋势
- **目的**: 了解自己的编码进度

### 场景 2: 团队日报
- **配置**: 不筛选作者（统计所有人）
- **时间**: 每天 17:00 发送
- **内容**: 团队整体统计 + 排名
- **目的**: 团队进度跟踪

### 场景 3: 周报月报
- **配置**: 手动选择日期范围
- **时间**: 手动发送
- **内容**: 完整趋势分析
- **目的**: 定期汇报

---

## 🔒 安全性

### 密码加密
- 使用 AES 加密算法
- 基于项目路径生成唯一密钥
- 配置文件中只存储加密后的密码

### 网络安全
- 支持 TLS/SSL 加密传输
- 使用官方邮箱授权码机制
- 不会泄露您的主密码

---

## 📊 数据示例

### 邮件内容数据结构

```java
{
    "authorName": "张三",
    "statisticsDate": "2025-10-22",
    "todayCommits": 12,
    "todayAdditions": 450,
    "todayDeletions": 120,
    "todayNetChanges": 330,
    "rankByCommits": 2,
    "rankByAdditions": 1,
    "totalAuthors": 5
}
```

---

## 🎯 优势特点

| 特点 | 说明 |
|------|------|
| 🔄 **自动化** | 定时自动发送，无需手动操作 |
| 🎨 **美观** | 精美的 HTML 邮件设计 |
| 🔐 **安全** | 密码加密存储，TLS/SSL 传输 |
| 📱 **兼容** | 支持主流邮箱服务商 |
| ⚡ **高效** | 复用现有 Git 统计数据 |
| 🛠️ **灵活** | 丰富的配置选项 |

---

## 📖 相关文档

1. **[详细设计方案](./Git统计邮件发送功能设计方案.md)** - 完整的架构和设计
2. **[快速实施指南](./Git统计邮件发送功能-快速实施指南.md)** - 具体代码实现
3. **本文档** - 方案总结和快速参考

---

## ❓ 常见问题

### Q1: 需要一直开着 IDE 才能发送邮件吗？
**A**: 是的，定时任务依赖 IDE 进程。如果您需要在 IDE 关闭时也能发送，可以考虑将服务独立部署。

### Q2: 支持哪些邮箱？
**A**: 支持所有提供 SMTP 服务的邮箱，包括 Gmail、QQ、163、Outlook 等。

### Q3: 邮件发送失败怎么办？
**A**: 
1. 检查 SMTP 配置是否正确
2. 确认使用的是授权码而非登录密码
3. 查看错误日志获取详细信息
4. 使用"测试连接"功能验证配置

### Q4: 可以发送给多个人吗？
**A**: 当前版本支持单个接收者，后续可扩展为多接收者。

### Q5: 邮件内容可以自定义吗？
**A**: 可以，您可以修改 HTML/文本模板文件来自定义邮件样式和内容。

---

## 🎉 总结

这是一个完整的、生产级的邮件发送解决方案，具有：

✅ **即插即用**: 清晰的实施步骤，快速集成  
✅ **功能完善**: 手动+定时，HTML+文本，配置+历史  
✅ **安全可靠**: 密码加密，错误处理，日志记录  
✅ **易于扩展**: 模块化设计，便于后续功能增强  

**开发难度**: ⭐⭐⭐ (中等)  
**预计工期**: 4-6 天  
**维护成本**: ⭐⭐ (低)

---

**文档版本**: 1.0  
**创建时间**: 2025-10-22  
**适用版本**: PandaCoder 2.0+  

有任何问题欢迎随时咨询！🚀

