# PandaCoder 插件更新提醒功能测试指南

## 🧪 测试目标

验证插件更新提醒功能的所有核心功能和交互流程是否正常工作。

## 📋 测试环境要求

### 必需条件
- ✅ IntelliJ IDEA 2024.1 或更高版本
- ✅ PandaCoder 插件已安装
- ✅ 网络连接正常（需要访问 JetBrains 插件市场）

### 可选条件
- 📝 测试不同的 IDE 版本
- 📝 测试不同的操作系统（Windows/macOS/Linux）

## 🔍 测试用例

### 测试用例 1: IDE启动时自动检查更新

**目标**: 验证IDE启动时会自动检查更新

**前置条件**:
- 更新设置中 `启用自动检查更新` 已勾选
- 更新设置中 `显示更新通知` 已勾选
- 提醒频率设置为 `每次启动`

**测试步骤**:
1. 完全关闭 IDEA
2. 重新启动 IDEA
3. 打开任意项目
4. 等待 5-15 秒

**预期结果**:
- ✅ IDE 启动后延迟约 5 秒开始检查
- ✅ 如有新版本，右下角显示 Balloon 通知
- ✅ 如无新版本，不显示通知
- ✅ 在 `idea.log` 中可以看到检查日志

**日志检查**:
```
INFO  - UpdateCheckService - 开始检查插件更新，当前版本: 2.2.0
INFO  - UpdateCheckService - 获取到最新版本: 2.3.0
INFO  - UpdateCheckService - 发现新版本: 2.2.0 -> 2.3.0
```

**测试结果**: ⬜ 通过 / ⬜ 失败

---

### 测试用例 2: 每天首次检查

**目标**: 验证每天首次打开项目时会检查更新

**前置条件**:
- 更新设置中 `启用自动检查更新` 已勾选
- 提醒频率设置为 `每天一次`

**测试步骤**:
1. 启动 IDEA 并等待检查完成（第一次）
2. 关闭并重新启动 IDEA（第二次）
3. 观察是否会再次检查更新

**预期结果**:
- ✅ 第一次启动：执行检查
- ✅ 第二次启动（同一天）：跳过检查
- ✅ 日志显示 "跳过更新检查：未启用或未到检查时间"

**测试结果**: ⬜ 通过 / ⬜ 失败

---

### 测试用例 3: 通知显示和内容

**目标**: 验证更新通知的显示效果和内容准确性

**前置条件**:
- 当前版本低于市场最新版本
- 或手动触发检查更新

**测试步骤**:
1. 触发更新检查（启动IDE或手动检查）
2. 观察右下角通知

**预期结果**:
- ✅ 通知在右下角显示（Balloon样式）
- ✅ 标题显示 "🎉 PandaCoder 新版本可用"
- ✅ 显示当前版本号
- ✅ 显示最新版本号
- ✅ 显示更新内容（如果有）
- ✅ 显示三个操作按钮：立即更新、明天提醒、忽略此版本
- ✅ 约15秒后自动消失（如无交互）

**测试结果**: ⬜ 通过 / ⬜ 失败

---

### 测试用例 4: "立即更新"按钮

**目标**: 验证点击"立即更新"按钮的行为

**测试步骤**:
1. 等待更新通知出现
2. 点击 `💡 立即更新` 按钮

**预期结果**:
- ✅ 通知立即关闭
- ✅ 浏览器打开插件市场页面
- ✅ URL为: https://plugins.jetbrains.com/plugin/27533-pandacoder
- ✅ 更新配置中记录该版本已提醒

**测试结果**: ⬜ 通过 / ⬜ 失败

---

### 测试用例 5: "明天提醒"按钮

**目标**: 验证点击"明天提醒"按钮的行为

**测试步骤**:
1. 等待更新通知出现
2. 点击 `⏰ 明天提醒` 按钮
3. 立即重启IDE

**预期结果**:
- ✅ 通知立即关闭
- ✅ 重启后不再显示通知（24小时内）
- ✅ 更新配置中记录提醒时间
- ✅ 24小时后会再次提醒

**验证方法**:
```
打开配置文件：
~/.config/JetBrains/.../pandacoder-update-settings.xml

检查 lastShownTime 字段是否更新
```

**测试结果**: ⬜ 通过 / ⬜ 失败

---

### 测试用例 6: "忽略此版本"按钮

**目标**: 验证点击"忽略此版本"按钮的行为

**测试步骤**:
1. 等待更新通知出现（假设版本为 2.3.0）
2. 点击 `🔕 忽略此版本` 按钮
3. 重启IDE多次

**预期结果**:
- ✅ 通知立即关闭
- ✅ 显示确认提示 "已忽略版本 2.3.0"
- ✅ 重启后不再显示该版本的通知
- ✅ 配置文件中 ignoredVersions 包含 "2.3.0"

**测试结果**: ⬜ 通过 / ⬜ 失败

---

### 测试用例 7: 重大版本更新通知

**目标**: 验证主版本号变化时显示特殊通知

**前置条件**:
- 当前版本: 2.x.x
- 最新版本: 3.0.0

**测试步骤**:
1. 触发更新检查

**预期结果**:
- ✅ 标题显示 "🎊 PandaCoder 重大版本更新！"
- ✅ 有特殊的重磅功能说明
- ✅ 文案更加强调更新的重要性
- ✅ 通知标记为重要（不会自动消失）

**测试结果**: ⬜ 通过 / ⬜ 失败

---

### 测试用例 8: 配置页面功能

**目标**: 验证配置页面的所有功能

**测试步骤**:
1. 打开 `Settings` → `Tools` → `PandaCoder` → `更新设置`
2. 测试各项配置

**子测试 8.1: 启用/禁用自动检查**
- 取消勾选 `启用自动检查更新`
- 点击 Apply → OK
- 重启IDE
- ✅ 预期：不会自动检查更新

**子测试 8.2: 启用/禁用通知**
- 取消勾选 `显示更新通知`
- 点击 Apply → OK
- 触发更新检查
- ✅ 预期：即使有新版本也不显示通知

**子测试 8.3: 提醒频率切换**
- 选择不同的提醒频率
- 点击 Apply → OK
- ✅ 预期：设置被正确保存

**子测试 8.4: 立即检查更新按钮**
- 点击 `立即检查更新` 按钮
- ✅ 预期：按钮变为"检查中..."
- ✅ 预期：2秒后恢复正常
- ✅ 预期：状态标签显示"已完成检查"

**子测试 8.5: 清除已忽略版本**
- 先忽略某个版本
- 点击 `清除已忽略版本` 按钮
- 确认操作
- ✅ 预期：显示成功提示
- ✅ 预期：该版本会重新提醒

**测试结果**: ⬜ 通过 / ⬜ 失败

---

### 测试用例 9: 版本比较逻辑

**目标**: 验证版本号比较的准确性

**测试数据**:
| 当前版本 | 最新版本 | 预期结果 |
|----------|----------|----------|
| 2.2.0 | 2.2.1 | 有新版本 ✅ |
| 2.2.0 | 2.3.0 | 有新版本 ✅ |
| 2.2.0 | 3.0.0 | 有新版本（重大更新） ✅ |
| 2.2.0 | 2.2.0 | 无新版本 ✅ |
| 2.2.1 | 2.2.0 | 无新版本 ✅ |
| 2.2.0 | 1.9.9 | 无新版本 ✅ |

**测试方法**:
- 修改代码中的 `CURRENT_VERSION` 常量
- 重新编译并测试
- 观察日志和通知行为

**测试结果**: ⬜ 通过 / ⬜ 失败

---

### 测试用例 10: 网络异常处理

**目标**: 验证网络问题时的处理

**测试步骤**:
1. 断开网络连接
2. 启动IDE并等待检查

**预期结果**:
- ✅ 不会显示错误对话框
- ✅ 不会影响IDE正常使用
- ✅ 日志中有警告信息
- ✅ 10秒后超时并结束检查

**日志检查**:
```
WARN  - UpdateCheckService - 请求插件市场API失败
WARN  - UpdateCheckService - 无法获取最新版本信息
```

**测试结果**: ⬜ 通过 / ⬜ 失败

---

### 测试用例 11: API超时处理

**目标**: 验证API请求超时的处理

**测试方法**:
- 修改 `HTTP_TIMEOUT_SECONDS` 为 1 秒
- 在慢速网络下测试

**预期结果**:
- ✅ 请求在1秒后超时
- ✅ 不会阻塞UI
- ✅ 日志记录超时信息

**测试结果**: ⬜ 通过 / ⬜ 失败

---

### 测试用例 12: 并发安全性

**目标**: 验证多次快速检查的安全性

**测试步骤**:
1. 快速多次点击 `立即检查更新` 按钮
2. 观察行为

**预期结果**:
- ✅ 不会崩溃
- ✅ 不会显示多个重复通知
- ✅ 按钮状态管理正常

**测试结果**: ⬜ 通过 / ⬜ 失败

---

## 🔧 调试技巧

### 查看日志

**方法一：IDE内查看**
1. `Help` → `Show Log in Finder/Explorer`
2. 打开 `idea.log`
3. 搜索 "UpdateCheckService"

**方法二：实时查看**
1. `Help` → `Diagnostic Tools` → `Debug Log Settings`
2. 添加：`#com.shuyixiao.update:trace`
3. 重启IDE
4. 查看实时日志

### 强制触发检查

**方法一：修改配置**
```xml
<!-- 编辑配置文件 -->
~/.config/JetBrains/.../pandacoder-update-settings.xml

<!-- 修改以下字段 -->
<lastCheckDate></lastCheckDate>
<lastShownTime>0</lastShownTime>
```

**方法二：删除配置文件**
```bash
# 删除配置文件
rm ~/.config/JetBrains/.../pandacoder-update-settings.xml

# 重启IDE，使用默认配置
```

### 模拟不同版本

修改 `VersionInfo.java` 或 `version.properties`:
```properties
version=2.1.0  # 设置为低于市场版本
```

## 📊 测试结果汇总表

| 测试用例 | 测试人 | 测试日期 | 测试环境 | 结果 | 备注 |
|----------|--------|----------|----------|------|------|
| TC1: IDE启动检查 | | | | ⬜ | |
| TC2: 每天首次检查 | | | | ⬜ | |
| TC3: 通知显示 | | | | ⬜ | |
| TC4: 立即更新 | | | | ⬜ | |
| TC5: 明天提醒 | | | | ⬜ | |
| TC6: 忽略版本 | | | | ⬜ | |
| TC7: 重大更新 | | | | ⬜ | |
| TC8: 配置页面 | | | | ⬜ | |
| TC9: 版本比较 | | | | ⬜ | |
| TC10: 网络异常 | | | | ⬜ | |
| TC11: API超时 | | | | ⬜ | |
| TC12: 并发安全 | | | | ⬜ | |

## 🐛 Bug报告模板

如果发现问题，请使用以下模板报告：

```markdown
### Bug描述
简要描述遇到的问题

### 重现步骤
1. 步骤一
2. 步骤二
3. 步骤三

### 预期行为
应该发生什么

### 实际行为
实际发生了什么

### 环境信息
- IDE版本：IntelliJ IDEA 2024.1.6
- 插件版本：PandaCoder 2.2.0
- 操作系统：macOS 14.5.0
- Java版本：17

### 日志信息
```text
粘贴相关日志
```

### 截图
如果可能，提供截图
```

## ✅ 测试完成检查清单

- [ ] 所有测试用例已执行
- [ ] 所有失败的测试已记录
- [ ] 所有发现的Bug已报告
- [ ] 测试结果已汇总
- [ ] 测试报告已提交

## 📝 测试报告模板

```markdown
# PandaCoder 更新提醒功能测试报告

## 测试信息
- 测试人：[姓名]
- 测试日期：[日期]
- 测试环境：[环境描述]
- 插件版本：2.2.0

## 测试结果汇总
- 总测试用例数：12
- 通过：X
- 失败：Y
- 跳过：Z
- 通过率：X/12 = XX%

## 发现的问题
1. [问题描述]
2. [问题描述]

## 测试结论
- [ ] 功能正常，可以发布
- [ ] 存在问题，需要修复
- [ ] 需要进一步测试

## 建议和改进
[提供改进建议]
```

---

**祝测试顺利！** 🎉

如有任何问题，请联系开发团队。

