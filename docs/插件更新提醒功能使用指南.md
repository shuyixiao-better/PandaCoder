# PandaCoder 插件更新提醒功能使用指南

## 📋 功能概述

PandaCoder 插件现已支持智能更新提醒功能，当有新版本发布时，会在 IDE 右下角以优雅的 Balloon 通知方式提醒用户更新。

## ✨ 核心特性

### 1. 智能检测时机
- ✅ **IDE启动检测**：每次启动 IDE 后延迟 5 秒自动检查（避免启动卡顿）
- ✅ **每天首次检测**：每天首次打开项目时自动检查更新
- ✅ **手动检测**：支持用户主动触发更新检查

### 2. 优雅的通知方式
- 🎈 **Balloon 通知**：在屏幕右下角显示，不阻塞工作流程
- ⏱️ **自动消失**：15秒后自动消失（除非用户交互）
- 🎨 **精美设计**：清晰展示版本信息和更新内容
- 🔕 **无声提醒**：默认不发出声音

### 3. 多种交互选项
- 💡 **立即更新**：一键跳转到插件市场更新页面
- ⏰ **明天提醒**：24小时后再次提醒
- 🔕 **忽略此版本**：不再显示该版本的更新通知
- ❌ **关闭通知**：直接关闭，7天后再提醒

### 4. 防打扰机制
- 🛡️ **智能频率控制**：避免频繁打扰用户
- 📝 **记住用户选择**：记录忽略的版本和提醒时间
- ⚙️ **灵活配置**：用户可自定义检查频率

## 🚀 快速开始

### 方式一：自动检测（推荐）

插件默认已启用自动更新检查，无需任何配置：

1. **启动 IDEA**
   - IDE 启动后 5 秒会自动检查更新
   - 如有新版本，右下角会显示通知

2. **每天首次使用**
   - 每天首次打开项目时会自动检查
   - 避免重复打扰

### 方式二：手动检测

1. 打开 `Settings / Preferences` → `Tools` → `PandaCoder` → `更新设置`
2. 点击 `立即检查更新` 按钮
3. 等待检查完成

## ⚙️ 配置选项

### 访问配置页面

```
Settings / Preferences → Tools → PandaCoder → 更新设置
```

### 配置项说明

#### 1. 启用自动检查更新
- **作用**：控制是否在IDE启动时自动检查更新
- **默认值**：✅ 已启用
- **建议**：保持启用，确保及时获得更新

#### 2. 显示更新通知
- **作用**：控制发现新版本时是否显示通知
- **默认值**：✅ 已启用
- **建议**：保持启用，避免错过重要更新

#### 3. 提醒频率

| 选项 | 说明 | 适用场景 |
|------|------|----------|
| 每次启动 | 每次启动IDE都检查 | 需要及时了解更新的用户 |
| **每天一次**（推荐） | 每天首次打开项目时检查 | 大多数用户的最佳选择 |
| 每周一次 | 每周首次打开项目时检查 | 不经常更新的用户 |
| 从不 | 不自动检查更新 | 完全手动控制的用户 |

## 📊 通知示例

### 标准版本更新通知

```
┌─────────────────────────────────────────────┐
│ 🎉 PandaCoder 新版本可用                    │
│                                              │
│ 📦 当前版本：2.2.0                           │
│ ✨ 最新版本：2.3.0                           │
│                                              │
│ 🚀 更新亮点：                                │
│    • AI代码识别功能增强                      │
│    • SQL解析性能优化                         │
│    • 修复已知问题                            │
│                                              │
│ [💡 立即更新] [⏰ 明天提醒] [🔕 忽略此版本]  │
└─────────────────────────────────────────────┘
```

### 重大版本更新通知

```
┌─────────────────────────────────────────────┐
│ 🎊 PandaCoder 重大版本更新！                 │
│                                              │
│ 📦 当前版本：2.9.9                           │
│ ✨ 最新版本：3.0.0                           │
│                                              │
│ 🌟 重磅功能：                                │
│    • 全新架构设计                            │
│    • 性能提升50%                             │
│    • UI界面全面升级                          │
│                                              │
│ 强烈建议更新以获得最佳体验                   │
│                                              │
│ [🚀 立即更新] [稍后] [不再提醒]              │
└─────────────────────────────────────────────┘
```

## 🎯 用户操作指南

### 场景1：发现新版本，想立即更新

1. 点击通知中的 `💡 立即更新` 按钮
2. 浏览器会自动打开插件市场页面
3. 在插件市场页面点击 `Update` 按钮
4. 等待下载和安装完成
5. 重启 IDE 以应用更新

### 场景2：暂时不想更新，明天再说

1. 点击通知中的 `⏰ 明天提醒` 按钮
2. 通知会立即关闭
3. 24小时后会再次提醒
4. 不影响当前工作

### 场景3：不想更新这个版本

1. 点击通知中的 `🔕 忽略此版本` 按钮
2. 该版本不会再显示更新提醒
3. 下一个版本发布时会重新提醒
4. 如需恢复，可在设置中清除忽略列表

### 场景4：关闭通知（延后提醒）

1. 点击通知右上角的 `❌` 关闭按钮
2. 通知立即关闭
3. 7天后会再次提醒
4. 继续当前工作

## 🔧 高级功能

### 清除已忽略版本

如果之前忽略了某些版本，现在想重新接收通知：

1. 打开 `Settings` → `Tools` → `PandaCoder` → `更新设置`
2. 点击 `清除已忽略版本` 按钮
3. 确认操作
4. 所有被忽略的版本将重新显示更新提醒

### 查看更新状态

在配置页面底部可以看到：
- 当前版本号
- 上次提醒的版本号
- 上次检查更新的日期
- 已忽略的版本数量

## 📝 常见问题 (FAQ)

### Q1: 为什么没有收到更新通知？

**可能原因：**
1. 自动检查更新被禁用
2. 更新通知被禁用
3. 提醒频率设置为"从不"
4. 该版本已被忽略
5. 未到提醒时间（24小时内已提醒过）

**解决方法：**
- 检查配置页面的所有设置
- 尝试手动检查更新
- 清除已忽略的版本

### Q2: 更新通知会影响IDE性能吗？

**不会！我们做了充分优化：**
- IDE启动后延迟5秒再检查，不影响启动速度
- 在后台线程中执行，不阻塞UI
- HTTP请求设置10秒超时，避免长时间等待
- 每天最多检查一次（默认设置）

### Q3: 可以完全禁用更新检查吗？

**可以！**
1. 打开配置页面
2. 取消勾选 `启用自动检查更新`
3. 点击 `Apply` 保存
4. 以后将不会自动检查更新

### Q4: 忽略某个版本后，如何恢复？

**方法一：清除所有忽略版本**
- 在配置页面点击 `清除已忽略版本`

**方法二：等待下一个版本**
- 下一个版本发布时会重新提醒

### Q5: 更新检查会消耗流量吗？

**流量消耗极小：**
- 每次检查只请求一个小的JSON文件（约1-2KB）
- 每天最多检查一次
- 总流量消耗可忽略不计

### Q6: 为什么启动后要延迟5秒才检查？

**这是为了优化用户体验：**
- IDE启动时需要加载很多组件
- 立即检查会占用资源，导致启动变慢
- 延迟5秒后，IDE已基本启动完成
- 此时检查不会影响用户体验

### Q7: 如何知道当前版本是否是最新的？

**方法一：查看配置页面**
- 配置页面底部显示当前版本号

**方法二：手动检查更新**
- 点击 `立即检查更新` 按钮
- 如果是最新版本，会显示"当前版本已是最新版本"

**方法三：访问插件市场**
- 打开 https://plugins.jetbrains.com/plugin/27533-pandacoder
- 查看最新发布的版本号

## 🛡️ 隐私和安全

### 数据收集说明

**我们不会收集任何个人信息！**

更新检查过程中：
- ✅ 只访问 JetBrains 官方插件市场 API
- ✅ 只获取插件的版本信息和更新说明
- ❌ 不收集用户的任何个人信息
- ❌ 不上传任何数据到我们的服务器
- ❌ 不追踪用户行为

### 本地存储

所有用户配置都存储在本地：
- 配置文件：`~/.config/JetBrains/.../pandacoder-update-settings.xml`
- 存储内容：提醒频率、忽略的版本列表、上次检查时间
- 不包含任何敏感信息

## 📞 反馈和支持

### 遇到问题？

1. **查看日志**
   - `Help` → `Show Log in Finder/Explorer`
   - 搜索 "UpdateCheckService" 查看更新检查日志

2. **联系作者**
   - 微信公众号：舒一笑的架构笔记
   - 邮箱：yixiaoshu88@163.com
   - GitHub Issues

### 功能建议

欢迎提供您的建议：
- 通过微信公众号留言
- 在 GitHub 创建 Issue
- 发送邮件到作者邮箱

## 📚 技术实现

### 架构设计

```
UpdateCheckService (检查服务)
    ↓ 调用
JetBrains Plugin Market API (插件市场API)
    ↓ 解析
PluginUpdateInfo (更新信息)
    ↓ 判断
UpdateNotificationService (通知服务)
    ↓ 显示
Balloon Notification (右下角通知)
    ↓ 用户选择
UpdateSettingsState (持久化配置)
```

### 关键时间节点

| 事件 | 时间 | 说明 |
|------|------|------|
| IDE 启动 | T0 | 插件开始加载 |
| 延迟检查 | T0 + 5s | 开始检查更新 |
| API 请求 | T0 + 5s ~ T0 + 15s | 请求插件市场API（最多10秒超时） |
| 显示通知 | T0 + 15s | 如有新版本，显示通知 |
| 自动消失 | T0 + 30s | 如用户未交互，通知自动消失 |

## 📈 版本历史

### v2.2.0 (当前版本)
- ✅ 实现完整的更新提醒功能
- ✅ 支持智能检测时机
- ✅ 优雅的 Balloon 通知
- ✅ 防打扰机制
- ✅ 用户配置界面

### 未来计划
- 📋 支持查看完整的更新日志
- 🔔 支持自定义通知样式
- 📊 统计更新频率和用户选择
- 🌐 支持更多语言

---

**感谢您使用 PandaCoder！** 🎉

如果这个功能帮助到了您，欢迎给我们的插件评分和留言！

技术分享 · 公众号：**舒一笑的架构笔记**

