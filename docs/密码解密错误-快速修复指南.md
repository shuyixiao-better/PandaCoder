# 🚨 密码解密错误 - 快速修复指南

## 问题现象

发送邮件时出现以下错误：
```
Failed to send email
java.lang.RuntimeException: Failed to decrypt password
Caused by: javax.crypto.IllegalBlockSizeException: Input length must be multiple of 16
```

---

## ⚡ 快速解决（3步搞定）

### 步骤1️⃣：重新编译插件

在项目根目录执行：

```bash
# Windows PowerShell
.\gradlew clean build

# 或者在 IDEA 中
# 右键点击项目 -> Gradle -> Tasks -> build -> build
```

### 步骤2️⃣：重新安装插件

1. 打开 IDEA 设置：`File` -> `Settings` -> `Plugins`
2. 找到 `PandaCoder` 插件，点击卸载
3. 重启 IDEA
4. 安装新编译的插件：
   - `Settings` -> `Plugins` -> `⚙️` -> `Install Plugin from Disk...`
   - 选择 `build/distributions/PandaCoder-x.x.x.zip`

### 步骤3️⃣：重新配置密码

1. 打开 Git 统计工具窗口
2. 切换到"邮件配置"标签页
3. 重新输入"发件人密码"
4. 点击"保存配置"
5. 点击"测试连接"验证

✅ **完成！** 密码已自动加密保存，问题解决。

---

## 🔧 备选方案

### 方案A：清除配置文件（如果上述方法不起作用）

1. **关闭 IDEA**

2. **删除配置文件**
   ```
   你的项目目录/.idea/gitStatEmailConfig.xml
   ```

3. **重新打开 IDEA**，重新配置邮件设置

### 方案B：手动修复配置文件

1. **编辑配置文件**
   ```
   你的项目目录/.idea/gitStatEmailConfig.xml
   ```

2. **找到并修改密码字段**
   ```xml
   <!-- 将这一行 -->
   <senderPassword>损坏的密码数据</senderPassword>
   
   <!-- 改为 -->
   <senderPassword></senderPassword>
   ```

3. **保存文件，重启 IDEA**，重新配置

---

## 🎯 为什么会出现这个问题？

1. **配置文件损坏**：密码数据不完整或被修改
2. **项目路径变化**：移动了项目文件夹，导致加密密钥改变
3. **手动编辑配置**：直接修改了 XML 配置文件
4. **版本升级**：从旧版本升级，密码格式不兼容

---

## ✨ 新版本改进

我已经修复了这个问题，新版本（v2.1.0）具有：

✅ **智能密码检测**：自动识别加密/明文密码  
✅ **容错机制**：解密失败不会崩溃  
✅ **向后兼容**：支持旧版本配置  
✅ **详细日志**：便于问题排查  

---

## 📞 仍然有问题？

### 查看详细日志

1. 打开 IDEA 日志：`Help` -> `Show Log in Explorer/Finder`
2. 查找包含 `PasswordEncryptor` 的错误信息
3. 将日志发送给开发者

### 常见问题

**Q: 重新保存配置后还是报错？**  
A: 尝试清除配置文件（方案A），然后重新配置。

**Q: 测试连接失败？**  
A: 检查以下内容：
   - SMTP 服务器地址和端口是否正确
   - 邮箱密码是否正确（建议使用应用专用密码）
   - 网络连接是否正常
   - 防火墙是否阻止了连接

**Q: 密码会被泄露吗？**  
A: 密码使用 AES 加密存储，基于项目路径生成密钥。建议：
   - 不要将 `.idea/gitStatEmailConfig.xml` 提交到版本控制
   - 使用 SMTP 应用专用密码（而非邮箱登录密码）

---

## 📚 相关文档

- [完整修复方案](./密码解密错误修复方案.md)
- [Git统计邮件发送功能设计方案](./Git统计邮件发送功能设计方案.md)

---

**技术支持**  
公众号：舒一笑的架构笔记  
GitHub: https://github.com/shuyixiao/PandaCoder

