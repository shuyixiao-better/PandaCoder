# JenkinsfilePro åŠŸèƒ½å®ç°æ€»ç»“

## ğŸ‰ å®ç°çŠ¶æ€ï¼šå®Œæˆ

PandaCoder æ’ä»¶å·²æˆåŠŸé›†æˆ JenkinsfilePro çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œä¸ºç”¨æˆ·æä¾›å®Œæ•´çš„ Jenkins Pipeline å¼€å‘æ”¯æŒã€‚

## ğŸ“‹ å·²å®ç°åŠŸèƒ½

### âœ… 1. æ ¸å¿ƒæ¶æ„ç»„ä»¶

#### 1.1 Jenkinsæ–‡ä»¶è¯†åˆ«ç³»ç»Ÿ
- **ä½ç½®**: `src/main/java/com/shuyixiao/jenkins/util/JenkinsFileDetector.java`
- **åŠŸèƒ½**: 
  - è‡ªåŠ¨è¯†åˆ« `Jenkinsfile` æ–‡ä»¶
  - æ£€æµ‹åŒ…å« `pipeline {}` çš„å£°æ˜å¼ Pipeline
  - æ£€æµ‹åŒ…å« `node {}` çš„è„šæœ¬å¼ Pipeline
  - æ”¯æŒå…±äº«åº“æ–‡ä»¶è¯†åˆ«

#### 1.2 PSIå·¥å…·ç±»
- **ä½ç½®**: `src/main/java/com/shuyixiao/jenkins/util/PsiUtils.java`
- **åŠŸèƒ½**:
  - æä¾› PSI å…ƒç´ æ“ä½œçš„ä¾¿åˆ©æ–¹æ³•
  - æ”¯æŒ Jenkins å†…ç½®æ–¹æ³•è¯†åˆ«
  - å®ç°ä¸Šä¸‹æ–‡åˆ†æå’Œä»£ç å—æ£€æµ‹

#### 1.3 è¯­æ³•æè¿°ç¬¦ç³»ç»Ÿ
- **ä½ç½®**: `src/main/java/com/shuyixiao/jenkins/model/Descriptor.java`
- **åŠŸèƒ½**:
  - å®šä¹‰ Jenkins Pipeline è¯­æ³•å…ƒç´ 
  - æ”¯æŒå‚æ•°ç±»å‹å’Œæ–‡æ¡£ä¿¡æ¯
  - æä¾›å®Œæ•´çš„è¯­æ³•æè¿°æ•°æ®æ¨¡å‹

### âœ… 2. æ™ºèƒ½æœåŠ¡ç³»ç»Ÿ

#### 2.1 GDSLæ ¸å¿ƒæœåŠ¡
- **ä½ç½®**: `src/main/java/com/shuyixiao/jenkins/gdsl/JenkinsGdslService.java`
- **åŠŸèƒ½**:
  - ç®¡ç† Jenkins Pipeline è¯­æ³•æè¿°ç¬¦
  - æä¾›çº¿ç¨‹å®‰å…¨çš„ç¼“å­˜æœºåˆ¶
  - æ”¯æŒåŠ¨æ€åŠ è½½å’Œé‡æ–°åŠ è½½
  - ä» XML æ–‡ä»¶è§£æè¯­æ³•å®šä¹‰

#### 2.2 æ™ºèƒ½è¡¥å…¨æä¾›å™¨
- **ä½ç½®**: `src/main/java/com/shuyixiao/jenkins/gdsl/JenkinsGdslMembersProvider.java`
- **åŠŸèƒ½**:
  - æä¾›ä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„è¡¥å…¨å»ºè®®
  - æ”¯æŒä¸åŒ Pipeline å—çš„æŒ‡ä»¤è¡¥å…¨
  - æ ¹æ®ä»£ç ä½ç½®æä¾›ç›¸åº”è¡¥å…¨é€‰é¡¹

### âœ… 3. ç¯å¢ƒå˜é‡å’Œå‚æ•°æ”¯æŒ

#### 3.1 æ˜ å°„å†…å®¹æä¾›å™¨
- **ä½ç½®**: `src/main/java/com/shuyixiao/jenkins/provider/JenkinsMapContentProvider.java`
- **åŠŸèƒ½**:
  - ä¸º `env` å¯¹è±¡æä¾›ç¯å¢ƒå˜é‡è¡¥å…¨
  - ä¸º `params` å¯¹è±¡æä¾›å‚æ•°è¡¥å…¨
  - æ™ºèƒ½è¯†åˆ«è‡ªå®šä¹‰ç¯å¢ƒå˜é‡
  - æ”¯æŒå‚æ•°ç±»å‹æ¨æ–­

### âœ… 4. æ–‡æ¡£æ”¯æŒç³»ç»Ÿ

#### 4.1 æ–‡æ¡£æä¾›å™¨
- **ä½ç½®**: `src/main/java/com/shuyixiao/jenkins/documentation/JenkinsDocumentationProvider.java`
- **åŠŸèƒ½**:
  - ä¸º Jenkins Pipeline æ–¹æ³•æä¾›è¯¦ç»†æ–‡æ¡£
  - ç”Ÿæˆ HTML æ ¼å¼çš„å¸®åŠ©ä¿¡æ¯
  - é›†æˆå¤–éƒ¨æ–‡æ¡£é“¾æ¥
  - æ”¯æŒæ–¹æ³•ç­¾åå’Œå‚æ•°è¯´æ˜

### âœ… 5. è¯­æ³•å®šä¹‰èµ„æº

#### 5.1 Jenkins Pipeline XML æè¿°ç¬¦
- **ä½ç½®**: `src/main/resources/descriptors/jenkinsPipeline.xml`
- **å†…å®¹**:
  - å®Œæ•´çš„ Jenkins Pipeline è¯­æ³•å®šä¹‰
  - åŒ…å«æ‰€æœ‰æ ¸å¿ƒæŒ‡ä»¤å’Œæ­¥éª¤
  - è¯¦ç»†çš„å‚æ•°å’Œæ–‡æ¡£ä¿¡æ¯
  - æ”¯æŒå£°æ˜å¼å’Œè„šæœ¬å¼ Pipeline

## ğŸ”§ æŠ€æœ¯ç‰¹ç‚¹

### æ¶æ„è®¾è®¡
- **æ¨¡å—åŒ–è®¾è®¡**: å„åŠŸèƒ½æ¨¡å—ç‹¬ç«‹ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•
- **çº¿ç¨‹å®‰å…¨**: ä½¿ç”¨ `ConcurrentHashMap` ç¡®ä¿å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„å®‰å…¨æ€§
- **ç¼“å­˜ä¼˜åŒ–**: å»¶è¿ŸåŠ è½½å’Œæ™ºèƒ½ç¼“å­˜æœºåˆ¶ï¼Œæå‡æ€§èƒ½
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œé™çº§æ–¹æ¡ˆ

### å…¼å®¹æ€§
- **IntelliJ IDEA**: æ”¯æŒ 2024.1+ ç‰ˆæœ¬
- **Groovy æ’ä»¶**: é›†æˆåŸç”Ÿ Groovy æ”¯æŒ
- **Java 17**: ä½¿ç”¨ç°ä»£ Java ç‰¹æ€§
- **è·¨å¹³å°**: æ”¯æŒ Windowsã€macOSã€Linux

### æ€§èƒ½ä¼˜åŒ–
- **XML è§£æ**: ä½¿ç”¨ DOM è§£æå™¨ï¼Œæ”¯æŒå®‰å…¨çš„ XML å¤„ç†
- **PSI ç¼“å­˜**: é¿å…é‡å¤çš„ PSI æ ‘éå†
- **å†…å­˜ç®¡ç†**: åˆç†çš„å¯¹è±¡ç”Ÿå‘½å‘¨æœŸç®¡ç†

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
src/main/java/com/shuyixiao/jenkins/
â”œâ”€â”€ gdsl/
â”‚   â”œâ”€â”€ JenkinsGdslService.java           # æ ¸å¿ƒè¯­æ³•æœåŠ¡
â”‚   â””â”€â”€ JenkinsGdslMembersProvider.java   # æ™ºèƒ½è¡¥å…¨æä¾›å™¨
â”œâ”€â”€ provider/
â”‚   â””â”€â”€ JenkinsMapContentProvider.java    # ç¯å¢ƒå˜é‡å’Œå‚æ•°æ˜ å°„
â”œâ”€â”€ documentation/
â”‚   â””â”€â”€ JenkinsDocumentationProvider.java # æ–‡æ¡£æ”¯æŒ
â”œâ”€â”€ model/
â”‚   â””â”€â”€ Descriptor.java                   # è¯­æ³•æè¿°ç¬¦æ¨¡å‹
â””â”€â”€ util/
    â”œâ”€â”€ JenkinsFileDetector.java          # æ–‡ä»¶ç±»å‹è¯†åˆ«
    â””â”€â”€ PsiUtils.java                     # PSI æ“ä½œå·¥å…·

src/main/resources/
â””â”€â”€ descriptors/
    â””â”€â”€ jenkinsPipeline.xml               # è¯­æ³•å®šä¹‰æ–‡ä»¶
```

## ğŸ¯ åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½ç‰¹æ€§ | JenkinsfileProåŸç‰ˆ | PandaCoderé›†æˆç‰ˆ | çŠ¶æ€ |
|---------|-------------------|-----------------|------|
| æ–‡ä»¶è¯†åˆ« | âœ… | âœ… | âœ… å·²å®ç° |
| æ™ºèƒ½è¡¥å…¨ | âœ… | âœ… | âœ… å·²å®ç° |
| ç¯å¢ƒå˜é‡è¡¥å…¨ | âœ… | âœ… | âœ… å·²å®ç° |
| å‚æ•°è¡¥å…¨ | âœ… | âœ… | âœ… å·²å®ç° |
| æ–‡æ¡£æ”¯æŒ | âœ… | âœ… | âœ… å·²å®ç° |
| è¯­æ³•é«˜äº® | âœ… | âœ… | âœ… é€šè¿‡Groovyæ’ä»¶ |
| é”™è¯¯æ£€æµ‹ | âœ… | âœ… | âœ… é€šè¿‡Groovyæ’ä»¶ |
| åº“ç®¡ç† | âœ… | âš ï¸ | ğŸ”„ éƒ¨åˆ†å®ç° |
| GDSLé›†æˆ | âœ… | âš ï¸ | ğŸ”„ ç®€åŒ–å®ç° |

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. åˆ›å»º Jenkinsfile
åœ¨é¡¹ç›®ä¸­åˆ›å»ºåä¸º `Jenkinsfile` çš„æ–‡ä»¶ï¼Œæ’ä»¶ä¼šè‡ªåŠ¨è¯†åˆ«å¹¶æä¾›æ”¯æŒã€‚

### 2. æ™ºèƒ½è¡¥å…¨
åœ¨ Jenkins Pipeline æ–‡ä»¶ä¸­è¾“å…¥ä»£ç æ—¶ï¼ŒIDE ä¼šè‡ªåŠ¨æä¾›ç›¸å…³è¡¥å…¨å»ºè®®ï¼š
- `pipeline` - åˆ›å»ºå£°æ˜å¼ Pipeline
- `agent` - å®šä¹‰æ‰§è¡Œä»£ç†
- `stages` - å®šä¹‰æ„å»ºé˜¶æ®µ
- `steps` - æ·»åŠ æ„å»ºæ­¥éª¤

### 3. ç¯å¢ƒå˜é‡è¡¥å…¨
åœ¨ä½¿ç”¨ `env.` æ—¶ä¼šè‡ªåŠ¨è¡¥å…¨ï¼š
```groovy
environment {
    MAVEN_OPTS = '-Xmx1024m'
}
stages {
    stage('Build') {
        steps {
            echo "Maven options: ${env.MAVEN_OPTS}"  // è‡ªåŠ¨è¡¥å…¨
        }
    }
}
```

### 4. å‚æ•°è¡¥å…¨
åœ¨ä½¿ç”¨ `params.` æ—¶ä¼šè‡ªåŠ¨è¡¥å…¨ï¼š
```groovy
parameters {
    string(name: 'BRANCH_NAME', defaultValue: 'main')
}
stages {
    stage('Deploy') {
        steps {
            echo "Branch: ${params.BRANCH_NAME}"  // è‡ªåŠ¨è¡¥å…¨
        }
    }
}
```

### 5. æ–‡æ¡£æŸ¥çœ‹
å°†é¼ æ ‡æ‚¬åœåœ¨ Jenkins æ–¹æ³•ä¸Šæˆ–æŒ‰ `Ctrl+Q` æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£ã€‚

## ğŸ“ ç¤ºä¾‹æ–‡ä»¶

é¡¹ç›®åŒ…å«å®Œæ•´çš„ç¤ºä¾‹æ–‡ä»¶ï¼š
- `Jenkinsfile.example` - å±•ç¤ºå„ç§ Pipeline åŠŸèƒ½çš„ä½¿ç”¨æ–¹æ³•
- `docs/JenkinsPipelineFeatures.md` - è¯¦ç»†çš„åŠŸèƒ½è¯´æ˜æ–‡æ¡£

## ğŸ‰ æˆå°±æ€»ç»“

âœ… **å®Œæ•´å¤åˆ»**: æˆåŠŸå®ç° JenkinsfilePro çš„æ ¸å¿ƒåŠŸèƒ½
âœ… **æ¶æ„ä¼˜åŒ–**: é‡‡ç”¨æ›´æ¸…æ™°çš„æ¨¡å—åŒ–è®¾è®¡
âœ… **æ€§èƒ½æå‡**: ä¼˜åŒ–çš„ç¼“å­˜å’ŒåŠ è½½æœºåˆ¶
âœ… **æ–‡æ¡£å®Œå–„**: æä¾›è¯¦ç»†çš„ä¸­æ–‡æ–‡æ¡£å’Œç¤ºä¾‹
âœ… **å…¼å®¹æ€§å¼º**: æ”¯æŒæœ€æ–°ç‰ˆæœ¬çš„ IntelliJ IDEA å’Œ Java
âœ… **æ‰©å±•æ€§å¥½**: ä¾¿äºåç»­åŠŸèƒ½æ‰©å±•å’Œç»´æŠ¤

## ğŸ”® åç»­æ‰©å±•æ–¹å‘

1. **å®Œæ•´GDSLé›†æˆ**: å®ç°æ›´å®Œæ•´çš„ Groovy DSL æ”¯æŒ
2. **åº“ç®¡ç†åŠŸèƒ½**: æ·»åŠ  Jenkins å…±äº«åº“ç®¡ç†
3. **å¯è§†åŒ–æ”¯æŒ**: Pipeline æµç¨‹å›¾å¯è§†åŒ–
4. **æ¨¡æ¿ç³»ç»Ÿ**: é¢„å®šä¹‰çš„ Pipeline æ¨¡æ¿
5. **æ’ä»¶é›†æˆ**: æ›´å¤š Jenkins æ’ä»¶çš„è¯­æ³•æ”¯æŒ

---

**PandaCoder + JenkinsfilePro = å®Œç¾çš„ Jenkins Pipeline å¼€å‘ä½“éªŒï¼** ğŸŠ 